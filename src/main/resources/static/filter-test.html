<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>요금제 필터 테스트</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; }
        .container { max-width: 800px; margin: 20px auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        fieldset { border: 1px solid #ccc; border-radius: 5px; margin-bottom: 20px; padding: 15px; }
        legend { font-weight: bold; font-size: 1.1em; padding: 0 10px; }
        label { margin-right: 15px; display: inline-block; cursor: pointer; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
        button { font-size: 1em; padding: 10px 20px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        #results-container { margin-top: 20px; }
        #resultList { list-style-type: none; padding-left: 0; }
        #resultList li { background-color: #f8f9fa; border: 1px solid #dee2e6; margin-top: -1px; padding: 12px; }
        pre { background-color: #e9ecef; padding: 15px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

<div class="container">
    <h2>📦 요금제 필터</h2>
    <form id="filterForm">
        <fieldset>
            <legend>카테고리</legend>
            <div class="grid-container">
                <label><input type="checkbox" name="category" value="1"> 5G 시그니처</label>
                <label><input type="checkbox" name="category" value="2"> 5G 프리미어</label>
                <label><input type="checkbox" name="category" value="3"> 5G 스페셜</label>
                <label><input type="checkbox" name="category" value="4"> 유스</label>
                <label><input type="checkbox" name="category" value="5"> 시니어</label>
            </div>
            <hr>
            <label><input type="checkbox" id="allCategories"> <strong>전체 카테고리</strong></label>
        </fieldset>

        <fieldset>
            <legend>요금 범위</legend>
            <div class="grid-container">
                <label><input type="checkbox" name="price" value="~5"> ~5만원대</label>
                <label><input type="checkbox" name="price" value="6~8"> 6~8만원대</label>
                <label><input type="checkbox" name="price" value="9~"> 9만원대~</label>
            </div>
            <hr>
            <label><input type="checkbox" id="anyPrice"> <strong>가격 상관없음</strong></label>
        </fieldset>

        <fieldset>
            <legend>데이터</legend>
            <div class="grid-container">
                <label><input type="checkbox" name="data" value="small"> 소용량</label>
                <label><input type="checkbox" name="data" value="large"> 대용량/무제한</label>
            </div>
            <hr>
            <label><input type="checkbox" id="anyData"> <strong>데이터 상관없음</strong></label>
        </fieldset>

        <fieldset>
            <legend>혜택</legend>
            <div class="grid-container">
                <label><input type="checkbox" name="benefit" value="3"> VVIP</label>
                <label><input type="checkbox" name="benefit" value="6"> 스마트기기</label>
                <label><input type="checkbox" name="benefit" value="7"> 콘텐츠</label>
                <label><input type="checkbox" name="benefit" value="8"> 구독</label>
            </div>
            <hr>
            <label><input type="checkbox" id="noBenefits"> <strong>혜택 필요없음</strong></label>
        </fieldset>

        <button type="button" onclick="submitFilter()">🔍 검색</button>
    </form>

    <div id="results-container">
        <h3>▶️ 요청 Body:</h3>
        <pre id="requestBodyPreview">요청 대기 중...</pre>
        <h3>📋 검색 결과:</h3>
        <ul id="resultList"></ul>
    </div>
</div>

<script>
    // '전체' 또는 '상관없음' 선택 시 다른 옵션 제어
    $(document).ready(function() {
        $('#allCategories').change(function() {
            $('input[name="category"]').prop('disabled', this.checked);
        });
        $('#anyPrice').change(function() {
            $('input[name="price"]').prop('disabled', this.checked);
        });
        $('#anyData').change(function() {
            $('input[name="data"]').prop('disabled', this.checked);
        });
        $('#noBenefits').change(function() {
            $('input[name="benefit"]').prop('disabled', this.checked);
        });
    });

    function submitFilter() {
        const requestBody = {
            categoryIds: [],
            allCategoriesSelected: $('#allCategories').is(':checked'),
            priceRanges: [],
            anyPriceSelected: $('#anyPrice').is(':checked'),
            dataOptions: [],
            anyDataSelected: $('#anyData').is(':checked'),
            benefitIds: [],
            noBenefitsSelected: $('#noBenefits').is(':checked')
        };

        // 카테고리 ID 수집
        if (!requestBody.allCategoriesSelected) {
            $('input[name="category"]:checked').each(function() {
                requestBody.categoryIds.push(parseInt($(this).val()));
            });
        }

        // 가격 범위 수집
        if (!requestBody.anyPriceSelected) {
            $('input[name="price"]:checked').each(function() {
                requestBody.priceRanges.push($(this).val());
            });
        }

        // 데이터 옵션 수집
        if (!requestBody.anyDataSelected) {
            $('input[name="data"]:checked').each(function() {
                requestBody.dataOptions.push($(this).val());
            });
        }

        // 혜택 ID 수집
        if (!requestBody.noBenefitsSelected) {
            $('input[name="benefit"]:checked').each(function() {
                requestBody.benefitIds.push(parseInt($(this).val()));
            });
        }

        // 요청 Body를 화면에 표시
        $('#requestBodyPreview').text(JSON.stringify(requestBody, null, 2));

        // AJAX 요청
        $.ajax({
            url: 'http://localhost:8084/plan/filter',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(requestBody),
            success: function(response) {
                const resultList = $('#resultList');
                resultList.empty();
                if (!response || response.length === 0) {
                    resultList.append('<li>조건에 맞는 요금제가 없습니다.</li>');
                    return;
                }
                response.forEach(plan => {
                    const fee = plan.monthlyFee ? plan.monthlyFee.toLocaleString() : 'N/A';
                    const category = plan.categoryName ? ` (${plan.categoryName})` : '';
                    resultList.append(`<li>${plan.planName}${category} - ${fee}원</li>`);
                });
            },
            error: function(xhr) {
                const resultList = $('#resultList');
                resultList.empty();
                resultList.append(`<li>오류가 발생했습니다: ${xhr.status} ${xhr.statusText}</li>`);
                console.error("Error:", xhr.responseText);
            }
        });
    }
</script>

</body>
</html>